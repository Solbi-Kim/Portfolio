<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Video.js CSS (CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/video.js@8/dist/video-js.css">

  <!-- 우리 CSS -->
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <main class="ccv-wrap">
    <!-- 우하단 CC 뱃지 -->
    <div class="ccv-frame">
    <div class="ccv-badge">SV</div>

    <!-- 비디오 -->
    <video
      id="shoviPlayer"
      class="video-js vjs-ccv"
      controls
      playsinline
      preload="metadata"
      poster=""
      data-setup="{}"
    ></video>
    </div>
  </main>

  <!-- CDN JS -->
  <script src="https://unpkg.com/video.js@8/dist/video.min.js"></script>
  <script src="https://unpkg.com/hls.js@latest"></script>
  
  <script>
    (function () {
      function ensurePlayer() {
        // 이미 있으면 그거 쓰고
        if (videojs.getPlayer) {
          const exist = videojs.getPlayer('shoviPlayer');
          if (exist) return exist;
        }
    
        // 없으면 여기서 새로 만들어
        return videojs('shoviPlayer', {
          controls: true,
          preload: 'metadata'
        });
      }
    
      function applyVideoAspect(p) {
        const tech = p && p.tech_ && p.tech_.el && p.tech_.el();
        if (!tech || !tech.videoWidth || !tech.videoHeight) return;
        const w = tech.videoWidth, h = tech.videoHeight;
        const frame = document.querySelector('.ccv-frame');
        if (frame) frame.style.setProperty('--ratio', `${w} / ${h}`);
      }
    
      function wire() {
        const p = ensurePlayer();
        if (!p) return;
    
        p.off('loadedmetadata', applyVideoAspect);
        p.off('loadeddata',     applyVideoAspect);
    
        p.on('loadedmetadata', () => applyVideoAspect(p));
        p.on('loadeddata',     () => applyVideoAspect(p));
      }
    
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', wire);
      } else {
        wire();
      }
      setTimeout(wire, 0);
    })();
  </script>


<script src="./app.js"></script>
  
</body>
</html>
